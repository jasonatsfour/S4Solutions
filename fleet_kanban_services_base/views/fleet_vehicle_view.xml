<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="fleet_vehicle_view_form_inherit_fleet_kanban_services_base" model="ir.ui.view">
        <field name="name">fleet.vehicle.form.inherit_fleet_kanban_services_base</field>
        <field name="model">fleet.vehicle</field>
        <field name="inherit_id" ref="fleet.fleet_vehicle_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('oe_title')]" position="replace">
                <div class="oe_title">
                    <label for="license_plate" class="oe_edit_only"/>
                    <h1>
                        <field name="license_plate" class="oe_inline" placeholder="e.g. PAE 326"/>
                    </h1>
                    <label for="model_id" class="oe_edit_only"/>
                    <h2>
                        <field name="model_id" placeholder="e.g. Model S"/>
                    </h2>
                    <label for="tag_ids" class="oe_edit_only"/>
                    <field name="tag_ids" widget="many2many_tags"
                           options="{'color_field': 'color', 'no_create_edit': True}"/>
                </div>
            </xpath>
            <field name='driver_id' position="before">
                <field name="product_id" required="1"/>
                <field name="vehicle_status_id" invisible="1"/>
                <field name="x_availability"/>
                <field name="color" invisible="1"/>
                <field name="x_location" string="Location" domain="[('asset_location', '=', True)]"/>
                <field name="x_flight_hours"/>
                <field name="x_serial_no"/>
                <field name="recurring_service_plan_id" string="Recurring Service Plan" invisible="1"/>
            </field>
            <xpath expr="//button[@name='return_action_to_open']" position="after">
                <button name="return_action_to_open_service"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-wrench"
                        context="{'xml_id':'action_vehicle_services'}"
                        help="show the services logs for this vehicle">
                    <field name="fleet_service_count" widget="statinfo" string="Service Requests"/>
                </button>
                <button name="return_action_to_open_recurring_plan_service"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-wrench"
                        context="{'xml_id':'action_vehicle_services'}"
                        help="show the services logs for this vehicle">
                    <field name="fleet_recurring_plan_service_count" widget="statinfo"
                           string="Recurring Service Requests"/>
                </button>
                <button name="return_action_to_open_repair"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-gear"
                        context="{'xml_id':'fleet_repair_action_main'}"
                        help="show the repair order for this vehicle">
                    <field name="fleet_repair_count" widget="statinfo" string="Repair Orders"/>
                </button>
            </xpath>
            <field name="company_id" position="after">
                <field name="x_hw_config"/>
            </field>
            <sheet position="inside">
                <notebook>
                    <page name="vehicle_service_history" string="Assigned Recurring Services">
                        <field name="vehicle_recurring_service_history_ids"
                               readonly="True" options="{'no_create_edit': True}">
                            <tree create="false" delete="false">
                                <field name="recurring_service_plan_id"/>
                                <field name="interval_threshold"/>
                                <field name="interval_hours"/>
                                <field name="services_request_template_id"/>
                                <field name="last_generated_hours"/>
                                <field name="hours_till_next_generation"/>
                                <field name="hours_till_next_generation_without_threshold"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
            </sheet>
        </field>
    </record>

    <record id="fleet_vehicle_view_kanban_inherit_fleet_kanban_services_base" model="ir.ui.view">
        <field name="name">fleet.vehicle.kanban</field>
        <field name="model">fleet.vehicle</field>
        <field name="inherit_id" ref="fleet.fleet_vehicle_view_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='contract_count']" position="after">
                <field name="color_index"/>
            </xpath>
            <xpath expr="//kanban/templates/t//div[hasclass('oe_kanban_global_click')]" position="replace">
                <div t-attf-class="#{kanban_color(record.color_index.raw_value)} oe_kanban_global_click o_has_icon">
                    <div class="o_kanban_image">
                        <img t-att-src="kanban_image('fleet.vehicle', 'image_128', record.id.raw_value)" alt="Vehicle"/>
                    </div>
                    <div class="oe_kanban_details">
                        <strong class="o_kanban_record_title">
                            <field name="license_plate"/>:
                            <field name="model_id"/>
                        </strong>
                        <div class="o_kanban_tags_section">
                            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                        </div>
                        <ul>
                            <li>
                                <t t-if="record.driver_id.raw_value">
                                    <field name="driver_id"/>
                                </t>
                            </li>
                            <li>
                                <t t-if="record.location.raw_value">
                                    <field name="location"/>
                                </t>
                            </li>
                        </ul>
                    </div>
                    <div class="o_kanban_button">
                        <a class="oe_kanban_action oe_kanban_action_a"
                           data-context="{&quot;xml_id&quot;:&quot;fleet_vehicle_log_contract_action&quot;,&quot;search_default_open&quot;: 1}"
                           data-name="return_action_to_open" data-type="object" href="#"
                           t-if="record.contract_count.raw_value&gt;0">
                            <field name="contract_count"/>Contract(s)
                            <span class="fa fa-exclamation-triangle" t-att-style="'color:orange'"
                                  t-if="record.contract_renewal_due_soon.raw_value and !record.contract_renewal_overdue.raw_value"/>
                            <span class="fa fa-exclamation-triangle" t-att-style="'color:red;'"
                                  t-if="record.contract_renewal_overdue.raw_value"/>
                        </a>
                    </div>
                </div>
            </xpath>
        </field>
    </record>
</odoo>
